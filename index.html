<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CuencaKongs</title>
    <audio id="background-audio" src="https://cdn.glitch.global/65f818fa-abf9-45cb-8c99-a24deed0d232/coscu.mp3?v=1734922178507" loop></audio>

    <style>
      
      /*-------------------------*/
           body {
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f7f7f7;
        }

        .confetti {
            position: absolute;
            font-size: 1.5rem;
            animation: explode 3s cubic-bezier(0.42, 0, 0.58, 1) forwards;
        }

        .confetti.spin {
            animation: explode 3s cubic-bezier(0.42, 0, 0.58, 1) forwards, spin 3s linear infinite;
        }

        @keyframes explode {
            0% {
                transform: scale(0.8) translate(0, 0);
                opacity: 1;
            }
            40% {
                transform: scale(1.2) translate(var(--x), var(--y));
                opacity: 0.9;
            }
            100% {
                transform: scale(1) translate(0, 100vh);
                opacity: 0;
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
      
      
      
        /* Estilos generales */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #ff0000; /* Fondo rojo */
            color: #ffffff; /* Texto blanco */
            display: flex;
            flex-direction: column; /* Asegura que todo esté en columna */
            height: 100vh; /* Asegura que la altura sea de 100vh */
            overflow: auto; /* Permite el desplazamiento */
        }

        /* Pantalla de carga */
        #loader {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #ff0000; /* Fondo rojo */
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 9999;
            opacity: 1;
            animation: fadeOut 1s ease-out 2s forwards; /* Desvanecimiento después de 2s */
        }

        #loader .text {
            font-size: 2em;
            margin-top: 10px;
        }

        /* Efecto de copos de nieve */
        .snowflake {
            color: #ffffff;
            font-size: 1.5em;
            position: absolute;
            top: -10%;
            animation: fall linear infinite, fadeOutSnow 1s ease-out 2.5s forwards;
        }

        /* Animación de caída de los copos de nieve */
        @keyframes fall {
            0% { transform: translateY(0); }
            100% { transform: translateY(110vh); }
        }

        /* Animación de desvanecimiento de los copos */
        @keyframes fadeOutSnow {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* Desvanecimiento del loader completo */
        @keyframes fadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* Barra de conteo */
        #countdown-container {
            position: fixed; /* Fijado en la parte superior */
            top: 0;
            left: 0;
            width: 100%;
            background-color: #000000; /* Fondo negro */
            z-index: 9998; /* Asegura que esté por encima de otros elementos */
            padding: 10px 0;
            text-align: center;
            box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.3); /* Sombra sutil */
        }

        /* Estilos del contador como botón negro */
        #countdown {
            padding: 10px 20px;
            font-size: 1.5em;
            color: #ff0000; /* Texto rojo */
            background-color: #000000; /* Fondo negro */
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Estilos del contenedor principal */
        .container {
            display: none; /* Ocultar el contenido inicialmente */
            padding: 20px;
            background-color: rgba(255, 0, 0, 0.8); /* Fondo rojo con transparencia */
            border-radius: 8px;
            max-width: 600px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            text-align: center;
            margin-top: 100px; /* Asegura que el contenido no se solape con el contador */
        }

        h1 {
            font-size: 3em;
            margin-bottom: 10px;
        }

        p {
            font-size: 1.2em;
            margin-top: 0;
        }

        /* Animación de rotación 360 grados */
        @keyframes rotate360 {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        /* Animación de meneo suave (efecto de ola) */
        @keyframes waveEffect {
            0% {
                transform: rotate(360deg);
            }
            50% {
                transform: rotate(355deg); /* Menos movimiento para un efecto más suave */
            }
            100% {
                transform: rotate(360deg);
            }
        }

        /* Efecto de Boom (expansión y contracción) */
        @keyframes boomEffect {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
            }
        }

        /* Estilo para los botones de la lista */
        .button-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 150px; /* Añadido espacio extra para los botones */
            align-items: center;
            width: 100%; /* Asegura que ocupe todo el ancho disponible */
            box-sizing: border-box; /* Para incluir el padding en el cálculo del tamaño */
            margin-bottom: 100px; /* Asegura que los botones no se solapen con el final de la página */
        }

        .button-list button {
            padding: 12px 25px;
            font-size: 1.2em;
            color: #ff0000; /* Texto rojo */
            background-color: #000000; /* Fondo negro */
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 250px; /* Establece un ancho fijo para los botones */
        }

        .button-list button:hover {
            background-color: #333333;
        }

        /* Estilo para el botón de sonido */
        #play-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-size: 1.5em; /* Tamaño de texto más pequeño */
            background-color: #ff0000;
            color: white;
            border: none;
            border-radius: 50%;
            padding: 12px; /* Menor padding para un botón más pequeño */
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: background-color 0.3s ease;
        }

        #play-button:hover {
            background-color: #cc0000;
        }

        /* Hacer que la página sea desplazable */
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
        }


.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.85);
    justify-content: center;
    align-items: center;
    z-index: 10000;
}

.modal-content {
    background: #000;
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    max-width: 90%;
}

.modal-content img {
    max-width: 100%;
    max-height: 70vh;
    border-radius: 8px;
}

.close {
    color: #fff;
    font-size: 2rem;
    cursor: pointer;
    float: right;
}

.arrows {
    margin-top: 10px;
    display: flex;
    justify-content: center;
    gap: 20px;
}

.arrows button {
    background: #ff0000;
    border: none;
    color: #fff;
    padding: 10px 15px;
    font-size: 1.2rem;
    border-radius: 8px;
    cursor: pointer;
}


    </style>
</head>
<body>
    <!-- Pantalla de carga con copos de nieve❄️-->
    <div id="loader">
        <div class="snowflake">🎃</div>
        <div class="text" id="loader-text">Organizando el viaje...</div>
    </div>

    <!-- Contenedor para el contador con barra negra -->
    <div id="countdown-container">
        <button id="countdown"></button>
    </div>

    <!-- Contenido principal -->
    <div class="content-wrapper">
        <div class="container" id="mainContent">
            <h1 id="title">CuencaKongs 2!</h1>

            <!-- Lista de botones -->
            <div class="button-list">
                <button onclick="openMemories()">Memories</button>
                <button onclick="openLogin()">Iniciar sesión</button>
<button id="profileButton">Perfil</button>

            </div>
        </div>
    </div>

    <!-- Botón de sonido -->
    <button id="play-button" onclick="toggleAudio()">🔊</button>

<script type="module">
/* ----------------------------- Nieve ----------------------------- */
function createSnowflakes() {
    for (let i = 0; i < 50; i++) {
        const snowflake = document.createElement("div");
        snowflake.classList.add("snowflake");
        snowflake.textContent = "🎃"; // ❄️
        snowflake.style.left = `${Math.random() * 100}vw`;
        snowflake.style.animationDuration = `${2 + Math.random() * 1.5}s`;
        snowflake.style.fontSize = `${1 + Math.random() * 1.5}em`;
        document.getElementById("loader").appendChild(snowflake);
    }
}
createSnowflakes();

/* ----------------------------- Loader y contenido ----------------------------- */
setTimeout(() => {
    document.getElementById("loader-text").innerText = "¡Listo!";
}, 2000);

setTimeout(() => {
    document.getElementById("loader").style.display = "none";
    document.getElementById("mainContent").style.display = "block";
    startCountdown();
}, 3000);

/* ----------------------------- Contador ----------------------------- */
function startCountdown() {
    const countdownElement = document.getElementById("countdown");
    const targetDate = new Date("November 2, 2025 08:11:00").getTime();

    function updateCountdown() {
        const now = new Date().getTime();
        const distance = targetDate - now;
        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        countdownElement.innerHTML = `Faltan: ${days} dias con ${hours} horas ${minutes} minutos y ${seconds} segundos`;

        if (distance < 0) {
            clearInterval(countdownInterval);
            countdownElement.innerHTML = "chau";
        }
    }

    const countdownInterval = setInterval(updateCountdown, 1000);
    updateCountdown();
}
window.startCountdown = startCountdown;

/* ----------------------------- Música ----------------------------- */
function toggleAudio() {
    const audio = document.getElementById("background-audio");
    const playButton = document.getElementById("play-button");
    if (audio.paused) {
        audio.play();
        playButton.textContent = "🔇";
    } else {
        audio.pause();
        playButton.textContent = "🔊";
    }
}
window.toggleAudio = toggleAudio;

/* ----------------------------- Título animado ----------------------------- */
function rotateTitle() {
    const title = document.getElementById("title");
    title.style.animation = "rotate360 2s ease-in-out";
    setTimeout(() => {
        title.style.animation = "waveEffect 1s ease-in-out";
        setTimeout(() => {
            title.style.animation = "boomEffect 0.5s ease-in-out";
            setTimeout(() => {
                title.style.animation = "boomEffect 0.5s ease-in-out";
            }, 500);
        }, 1000);
    }, 2000);
}
setInterval(rotateTitle, 5000);
window.rotateTitle = rotateTitle;

/* ----------------------------- Confetti ----------------------------- */
function randomInRange(min, max) { return Math.random() * (max - min) + min; }

function createConfetti() {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.textContent = '🎉';
    if (Math.random() > 0.7) confetti.classList.add('spin');
    confetti.style.left = `${randomInRange(0, window.innerWidth)}px`;
    confetti.style.top = `${randomInRange(0, window.innerHeight / 2)}px`;
    confetti.style.setProperty('--x', `${randomInRange(-150, 150)}px`);
    confetti.style.setProperty('--y', `${randomInRange(-100, 100)}px`);
    confetti.style.animationDuration = `${randomInRange(2.5, 3)}s`;
    document.body.appendChild(confetti);
    confetti.addEventListener('animationend', () => confetti.remove());
}

function explodeConfetti() {
    for (let i = 0; i < 80; i++) setTimeout(createConfetti, i * 15);
}
const triggerDate = new Date('2025-11-02T00:00:00'); 
if (new Date() >= triggerDate) window.onload = explodeConfetti;
window.explodeConfetti = explodeConfetti;

/* ----------------------------- Memories ----------------------------- */
const photos = [
    "https://i.imgur.com/Tv7Fv4G.jpeg", "https://i.imgur.com/KtTiF05.jpeg",
    "https://i.imgur.com/C91EBGl.jpeg", "https://i.imgur.com/Jp6QHle.jpeg",
    "https://i.imgur.com/XHzXuE6.jpeg", "https://i.imgur.com/mAoj9av.jpeg",
    "https://i.imgur.com/RYgzzm6.jpeg", "https://i.imgur.com/0YtrsGs.jpeg",
    "https://i.imgur.com/alUGmLw.jpeg", "https://i.imgur.com/xrjRwsx.jpeg",
    "https://i.imgur.com/Q0yVUqC.jpeg", "https://i.imgur.com/F8utfDA.jpeg"
];
let currentIndex = 0;

function openMemories() {
    const modal = document.getElementById("memoriesModal");
    currentIndex = Math.floor(Math.random() * photos.length);
    document.getElementById("memoryImage").src = photos[currentIndex];
    modal.style.display = "flex";
}
function closeMemories() { document.getElementById("memoriesModal").style.display = "none"; }
function nextPhoto() {
    currentIndex = (currentIndex + 1) % photos.length;
    document.getElementById("memoryImage").src = photos[currentIndex];
}
function prevPhoto() {
    currentIndex = (currentIndex - 1 + photos.length) % photos.length;
    document.getElementById("memoryImage").src = photos[currentIndex];
}
window.openMemories = openMemories;
window.closeMemories = closeMemories;
window.nextPhoto = nextPhoto;
window.prevPhoto = prevPhoto;

/* ----------------------------- Firebase ----------------------------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyB6l2qW57yNWDssci4CuFWDSHX-tn4cWxA",
  authDomain: "cuencakongs2.firebaseapp.com",
  projectId: "cuencakongs2",
  storageBucket: "cuencakongs2.firebasestorage.app",
  messagingSenderId: "605592434535",
  appId: "1:605592434535:web:ddf65325597814fb1661c2",
  measurementId: "G-22R6QMBGWN"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();
const storage = getStorage();

/* ---------- Elementos ---------- */
const authModal = document.getElementById("authModal");
const loginForm = document.getElementById("loginForm");
const registerForm = document.getElementById("registerForm");
const profileForm = document.getElementById("profileForm");
const authButton = document.getElementById("profileButton");
const profileModal = document.getElementById("profileModal");

/* ---------- Funciones ---------- */
function openLogin() {
    authModal.style.display = "flex";
    loginForm.style.display = "block";
    registerForm.style.display = "none";
    profileForm.style.display = "none";
}
function showRegister() { loginForm.style.display = "none"; registerForm.style.display = "block"; }
function showLogin() { loginForm.style.display = "block"; registerForm.style.display = "none"; }
function closeAuth() { authModal.style.display = "none"; }

async function registerUser() {
    const nickname = document.getElementById("regNickname").value;
    const email = document.getElementById("regEmail").value;
    const password = document.getElementById("regPassword").value;
    try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        await setDoc(doc(db, "usuarios", user.uid), { nickname, email });
        alert("Cuenta creada exitosamente!");
        showProfile(user);
    } catch (error) { alert(error.message); }
}

async function loginUser() {
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;
    try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        showProfile(userCredential.user);
    } catch (error) { alert(error.message); }
}
document.querySelector("#authModal .close").addEventListener("click", () => {
    document.getElementById("authModal").style.display = "none";
});


async function showProfile(user) {
    loginForm.style.display = "none";
    registerForm.style.display = "none";
    profileForm.style.display = "block";
    const docSnap = await getDoc(doc(db, "usuarios", user.uid));
    if (docSnap.exists()) {
        const data = docSnap.data();
        document.getElementById("profileNickname").innerText = `Nickname: ${data.nickname}`;
        document.getElementById("profileEmail").innerText = `Email: ${data.email}`;
    }
    authButton.innerText = "Perfil";
    authModal.style.display = "flex";
}

async function saveProfile() {
    const user = auth.currentUser;
    if (!user) return;
    const description = document.getElementById("profileDescription").value;
    await updateDoc(doc(db, "usuarios", user.uid), { description });
    alert("Perfil actualizado!");
}

async function changeProfilePhoto(event) {
    const file = event.target.files[0];
    if (!file) return;
    const user = auth.currentUser;
    if (!user) return;
    const storageRef = ref(storage, `profilePhotos/${user.uid}`);
    await uploadBytes(storageRef, file);
    const photoURL = await getDownloadURL(storageRef);
    await updateDoc(doc(db, "usuarios", user.uid), { profilePhotoURL: photoURL });
    document.getElementById("profilePhoto").src = photoURL;
    alert("Foto de perfil actualizada!");
}

function openProfile() { profileModal.style.display = "flex"; loadProfile(); }
function closeProfile() { profileModal.style.display = "none"; }
async function loadProfile() {
    const user = auth.currentUser;
    if (!user) return;
    const docSnap = await getDoc(doc(db, "usuarios", user.uid));
    if (docSnap.exists()) {
        const data = docSnap.data();
        document.getElementById("profileNickname").innerText = data.nickname;
        document.getElementById("profileEmail").innerText = data.email;
        document.getElementById("profileDescription").value = data.description || "";
        document.getElementById("profilePhoto").src = data.profilePhotoURL || "https://i.imgur.com/0y0y0y0.png";
    }
}

function logoutUser() {
    signOut(auth).then(() => {
        alert("Sesión cerrada");
        authButton.innerText = "Iniciar sesión";
        authModal.style.display = "none";
        profileModal.style.display = "none";
    });
}



/* ---------- Eventos ---------- */
authButton.addEventListener("click", () => {
    if (auth.currentUser) openProfile();
    else openLogin();
});


onAuthStateChanged(auth, (user) => { if (user) showProfile(user); });

/* ---------- Exponer funciones globales para HTML ---------- */
window.openLogin = openLogin;
window.showRegister = showRegister;
window.showLogin = showLogin;
window.registerUser = registerUser;
window.loginUser = loginUser;
window.logoutUser = logoutUser;
window.openProfile = openProfile;
window.closeProfile = closeProfile;
window.saveProfile = saveProfile;
window.changeProfilePhoto = changeProfilePhoto;
</script>


<div id="memoriesModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeMemories()">✖</span>
        <img id="memoryImage" src="" alt="Foto del viaje">
        <div class="arrows">
            <button onclick="prevPhoto()">◀️</button>
            <button onclick="nextPhoto()">▶️</button>
        </div>
    </div>
</div>

<!-- Modal de autenticación -->
<div id="authModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeAuth()">✖</span>

        <!-- Login -->
        <div id="loginForm">
            <h3>Iniciar Sesión</h3>
            <input type="email" id="loginEmail" placeholder="Correo" style="width:100%; margin-bottom:10px;">
            <input type="password" id="loginPassword" placeholder="Contraseña" style="width:100%; margin-bottom:10px;">
            <button onclick="login()">Iniciar Sesión</button>
            <p style="margin-top:10px;">No tienes cuenta? 
                <span style="color:blue; cursor:pointer;" onclick="showRegister()">Crea tu cuenta aquí</span>
            </p>
        </div>

        <!-- Registro -->
        <div id="registerForm" style="display:none;">
            <h3>Crear Cuenta</h3>
            <input type="text" id="regNickname" placeholder="Nickname" style="width:100%; margin-bottom:10px;">
            <input type="email" id="regEmail" placeholder="Correo" style="width:100%; margin-bottom:10px;">
            <input type="password" id="regPassword" placeholder="Contraseña" style="width:100%; margin-bottom:10px;">
            <button onclick="register()">Crear Cuenta</button>
            <p style="margin-top:10px;">¿Ya tienes cuenta? 
                <span style="color:blue; cursor:pointer;" onclick="showLogin()">Inicia sesión aquí</span>
            </p>
        </div>

        <!-- Perfil -->
        <div id="profileForm" style="display:none;">
            <h3>Perfil</h3>
            <p id="profileNickname"></p>
            <p id="profileEmail"></p>
            <button onclick="logout()">Cerrar Sesión</button>
        </div>
    </div>
</div>

<div id="profileModal" class="modal">
  <div class="modal-content" style="max-width:400px; padding:0; overflow:hidden;">
    <span class="close" onclick="closeProfile()">✖</span>
    <!-- Banner -->
    <div style="width:100%; height:100px; background: url('https://i.imgur.com/8Km9tLL.jpg') center/cover no-repeat;"></div>
    
    <!-- Foto de perfil -->
    <div style="position:relative; margin-top:-50px; text-align:center;">
      <img id="profilePhoto" src="https://i.imgur.com/0y0y0y0.png" alt="Foto de perfil" style="width:100px; height:100px; border-radius:50%; border:4px solid white; object-fit:cover;">
      <input type="file" id="profilePhotoInput" style="display:none;" accept="image/*" onchange="changeProfilePhoto(event)">
      <button onclick="document.getElementById('profilePhotoInput').click()" style="margin-top:10px;">Cambiar foto</button>
    </div>
    
    <!-- Info usuario -->
    <div style="padding:10px; text-align:center;">
      <h3 id="profileNickname">Nickname</h3>
      <p id="profileEmail">email@example.com</p>
      <textarea id="profileDescription" placeholder="Escribe tu descripción..." style="width:100%; height:60px; margin-bottom:10px;"></textarea>
      <button onclick="saveProfile()" style="width:100%; margin-bottom:10px;">Guardar cambios</button>
      <button onclick="logout()" style="width:100%; background:red; color:white;">Cerrar sesión</button>
    </div>
  </div>
</div>
</body>
</html>
